(function(t){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),t.Pupil={}})(window),function(t){t.Exception=function(t){this.message=t}}(window.Pupil),function(t){t.LexerException=t.Exception}(window.Pupil),function(t){t.ParserException=t.Exception}(window.Pupil),function(t){t.ValidatorException=t.Exception}(window.Pupil),function(t){t.Lexer=function(){this.TOKEN_TYPE_SUB_OPEN=1,this.TOKEN_TYPE_SUB_CLOSE=2,this.TOKEN_TYPE_OPERATOR=3,this.TOKEN_TYPE_IDENTIFIER=4},t.Lexer.prototype.tokenize=function(t){for(var i=[],n=t.trim(),o="",e=!1,r=[],c=0;n.length>c;c++){var s=n.charAt(c),a=null;n.length>c+1&&(a=n.charAt(c+1)),"("==s?(e=!0,r=[this.TOKEN_TYPE_SUB_OPEN]):")"==s?(e=!0,r=[this.TOKEN_TYPE_SUB_CLOSE]):"|"==s&&"|"==a?(e=!0,r=[this.TOKEN_TYPE_OPERATOR,1],c++):"&"==s&&"&"==a?(e=!0,r=[this.TOKEN_TYPE_OPERATOR,2],c++):o+=s,e&&(o=o.trim(),""!==o&&(i.push([this.TOKEN_TYPE_IDENTIFIER,o]),o=""),e=!1),r.length>0&&(i.push(r),r=[])}return o=o.trim(),""!==o&&(i.push([this.TOKEN_TYPE_IDENTIFIER,o]),o=""),i}}(window.Pupil),function(t){t.Block=function(){this.id=0,this.type=0,this.identifier="",this.operator=0,this.blocks=[]},t.Block.prototype.toString=function(){return"Block #"+this.id}}(window.Pupil),function(t){t.BlockFactory=function(t){this.Block=t,this.currentId=1},t.BlockFactory.prototype.getInstance=function(){var t=new this.Block;return t.id=this.currentId++,t},t.BlockFactory.prototype.getIdentifierInstance=function(){var t=this.getInstance();return t.type=1,t},t.BlockFactory.prototype.getOperatorInstance=function(){var t=this.getInstance();return t.type=2,t},t.BlockFactory.prototype.getSubBlockInstance=function(){var t=this.getInstance();return t.type=3,t}}(window.Pupil),function(t){t.Parser=function(t,i){this.Lexer=t,this.BlockFactory=i},t.Parser.prototype.parse=function(t){var i=this.Lexer.tokenize(t),n=this.tokensToBlocks(i);return n},t.Parser.prototype.openSubBlock=function(t){var i=this.BlockFactory.getSubBlockInstance();return t.blocks.push(i),i},t.Parser.prototype.tokensToBlocks=function(i){for(var n=this.BlockFactory.getSubBlockInstance(),o=n,e=[],r=null,c=0;i.length>c;c++){var s=i[c];if(s[0]==this.Lexer.TOKEN_TYPE_SUB_OPEN)e.push(o),o=this.openSubBlock(o);else if(s[0]==this.Lexer.TOKEN_TYPE_SUB_CLOSE){if(!(e.length>0))throw new t.ParserException("No block to ascend to!");o=e.pop()}else s[0]==this.Lexer.TOKEN_TYPE_OPERATOR?(r=this.BlockFactory.getOperatorInstance(),r.operator=s[1],o.blocks.push(r)):s[0]==this.Lexer.TOKEN_TYPE_IDENTIFIER&&(r=this.BlockFactory.getIdentifierInstance(),r.identifier=s[1],o.blocks.push(r))}if(e.length>0)throw new t.ParserException("Unclosed blocks!");return n}}(window.Pupil),function(t){t.Validator=function(i){if(i!==void 0)this.Parser=i;else{var n=new t.Lexer,o=new t.BlockFactory(t.Block);this.Parser=new t.Parser(n,o)}this.ruleValues={},this.validationFunctions={},this.addDefaultFunctions()},t.Validator.prototype.addFunction=function(t,i){this.validationFunctions[t]=i},t.Validator.prototype.addDefaultFunctions=function(){},t.Validator.prototype.validate=function(t){var i,n=[];for(i in t)this.ruleValues[i]=t[i][0];for(i in t){var o=t[i][0],e=this.Parser.parse(t[i][1]);n[i]=this.validateBlock(o,e)}return this.ruleValues={},n},t.Validator.prototype.validateBlock=function(i,n){for(var o=!1,e=1,r=0;n.blocks.length>r;r++){var c=n.blocks[r];if(1==c.type){var s="",a=[],x=c.identifier.split(":");if(s=x[0],this.validationFunctions[s]===void 0)throw new t.ValidatorException("Validator function '"+s+"' was not found!");x.length>=2&&(a=x[1].split(","));var u=[this,i].concat(a),l=this.validationFunctions[s].apply(this,u);1==e&&l?o=!0:2==e&&(o=o&&l?!0:!1)}else if(2==c.type)e=c.operator;else if(3==c.type){var p=this.validateBlock(i,c);1==e&&p?o=!0:2==e&&(o=o&&p?!0:!1)}}return o}}(window.Pupil),function(t){t.Validator.prototype.addDefaultFunctions=function(){this.addFunction("required",function(t,i){return i===void 0||""===i||null===i?!1:!0}),this.addFunction("min",function(t,i,n){return!isNaN(parseFloat(i))&&isFinite(i)?i>=n:i.length>=n}),this.addFunction("max",function(t,i,n){return!isNaN(parseFloat(i))&&isFinite(i)?n>=i:n>=i.length}),this.addFunction("between",function(t,i,n,o){return!isNaN(parseFloat(i))&&isFinite(i)?i>=n&&o>=i:i.length>=n&&o>=i.length}),this.addFunction("email",function(t,i){var n=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;return n.test(i)})}}(window.Pupil);