(function(t){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),t.Pupil={}})(window),function(t){t.Exception=function(t){this.message=t}}(window.Pupil),function(t){t.LexerException=t.Exception}(window.Pupil),function(t){t.ParserException=t.Exception}(window.Pupil),function(t){t.ValidatorException=t.Exception}(window.Pupil),function(t){t.Lexer=function(){this.tokenTypes={TOKEN_TYPE_SUB_OPEN:1,TOKEN_TYPE_SUB_CLOSE:2,TOKEN_TYPE_OPERATOR:3,TOKEN_TYPE_IDENTIFIER:4,TOKEN_TYPE_NEGATION:5};for(var t in this.tokenTypes)this[t]=this.tokenTypes[t]},t.Lexer.prototype.getTokenTypes=function(){return this.tokenTypes},t.Lexer.prototype.tokenize=function(t){for(var n=[],i=t.trim(),e="",o=!1,r=!1,s=[],a=0;i.length>a;a++){var c=i.charAt(a),u=null;i.length>a+1&&(u=i.charAt(a+1)),r||("("==c?(o=!0,s=[this.TOKEN_TYPE_SUB_OPEN]):")"==c?(o=!0,s=[this.TOKEN_TYPE_SUB_CLOSE]):"|"==c&&"|"==u?(o=!0,s=[this.TOKEN_TYPE_OPERATOR,1],a++):"&"==c&&"&"==u?(o=!0,s=[this.TOKEN_TYPE_OPERATOR,2],a++):"!"==c?(o=!0,s=[this.TOKEN_TYPE_NEGATION]):e+=c),o&&(e=e.trim(),""!==e&&(n.push([this.TOKEN_TYPE_IDENTIFIER,e]),e=""),o=!1),s.length>0&&(n.push(s),s=[])}return e=e.trim(),""!==e&&(n.push([this.TOKEN_TYPE_IDENTIFIER,e]),e=""),n}}(window.Pupil),function(t){t.Block=function(){this.id=0,this.type=0,this.identifier="",this.operator=0,this.blocks=[]},t.Block.prototype.toString=function(){return"Block #"+this.id}}(window.Pupil),function(t){t.BlockFactory=function(t){this.Block=t,this.currentId=1},t.BlockFactory.prototype.getInstance=function(){var t=new this.Block;return t.id=this.currentId++,t},t.BlockFactory.prototype.getIdentifierInstance=function(){var t=this.getInstance();return t.type=1,t},t.BlockFactory.prototype.getOperatorInstance=function(){var t=this.getInstance();return t.type=2,t},t.BlockFactory.prototype.getSubBlockInstance=function(){var t=this.getInstance();return t.type=3,t},t.BlockFactory.prototype.getNegationInstance=function(){var t=this.getInstance();return t.type=4,t}}(window.Pupil),function(t){t.Parser=function(t,n){this.Lexer=t,this.BlockFactory=n},t.Parser.prototype.parse=function(n){var i,e;if("string"==typeof n)i=this.Lexer.tokenize(n);else{if("object"!=typeof n)throw new t.ParserException("Unknown input type:"+typeof n);i=n}return e=this.tokensToBlocks(i)},t.Parser.prototype.openSubBlock=function(t){var n=this.BlockFactory.getSubBlockInstance();return t.blocks.push(n),n},t.Parser.prototype.tokensToBlocks=function(n){for(var i=this.BlockFactory.getSubBlockInstance(),e=i,o=[],r=null,s=0;n.length>s;s++){var a=n[s];if(a[0]==this.Lexer.TOKEN_TYPE_SUB_OPEN)o.push(e),e=this.openSubBlock(e);else if(a[0]==this.Lexer.TOKEN_TYPE_SUB_CLOSE){if(!(o.length>0))throw new t.ParserException("No block to ascend to!");e=o.pop()}else a[0]==this.Lexer.TOKEN_TYPE_OPERATOR?(r=this.BlockFactory.getOperatorInstance(),r.operator=a[1],e.blocks.push(r)):a[0]==this.Lexer.TOKEN_TYPE_IDENTIFIER?(r=this.BlockFactory.getIdentifierInstance(),r.identifier=a[1],e.blocks.push(r)):a[0]==this.Lexer.TOKEN_TYPE_NEGATION&&(r=this.BlockFactory.getNegationInstance(),e.blocks.push(r))}if(o.length>0)throw new t.ParserException("Unclosed blocks!");return i}}(window.Pupil),function(t){t.Validator=function(n){if(n!==void 0)this.Parser=n;else{var i=new t.Lexer,e=new t.BlockFactory(t.Block);this.Parser=new t.Parser(i,e)}this.ruleValues={},this.validationFunctions={},this.addDefaultFunctions()},t.Validator.prototype.addFunction=function(t,n){var i=t.charAt(0).toUpperCase()+t.substr(1);this.validationFunctions[t]=n,this.validationFunctions["other"+i]=function(){var n=Array.prototype.slice.call(arguments,0),i=this.ruleValues[n[0]];return n.splice(1,2,i),validationFunctions[t].apply(this,n)},this.validationFunctions["not"+i]=function(){return!validationFunctions[t].apply(this,arguments)},this.validationFunctions["notOther"+i]=function(){return!validationFunctions["other"+i].apply(this,arguments)}},t.Validator.prototype.addDefaultFunctions=function(){},t.Validator.prototype.getFunctions=function(){return this.validationFunctions},t.Validator.prototype.validate=function(t){var n,i=[];for(n in t)this.ruleValues[n]=t[n][0];for(n in t){var e=t[n][0],o=this.Parser.parse(t[n][1]);i[n]=this.validateBlock(e,o)}return this.ruleValues={},i},t.Validator.prototype.validateBlock=function(n,i){for(var e=!1,o=1,r=!1,s=0;i.blocks.length>s;s++){var a=i.blocks[s],c=!1,u=!1;if(1==a.type){var x="",l=[],p=a.identifier.split(":");if(x=p[0],this.validationFunctions[x]===void 0)throw new t.ValidatorException("Validator function '"+x+"' was not found!");p.length>=2&&(l=p[1].split(","));var h=[this,n].concat(l);c=!0,u=this.validationFunctions[x].apply(this,h)}else 2==a.type?o=a.operator:3==a.type?(c=!0,u=this.validateBlock(n,a)):4==a.type&&(r=!0);c&&(r&&(u=!u,r=!1),1==o&&u?e=!0:2==o&&(e=e&&u?!0:!1))}return e}}(window.Pupil),function(t){t.Validator.prototype.addDefaultFunctions=function(){this.addFunction("required",function(t,n){return n===void 0||""===n||null===n?!1:!0}),this.addFunction("min",function(t,n,i){return!isNaN(parseFloat(n))&&isFinite(n)?n>=i:n.length>=i}),this.addFunction("max",function(t,n,i){return!isNaN(parseFloat(n))&&isFinite(n)?i>=n:i>=n.length}),this.addFunction("between",function(t,n,i,e){return!isNaN(parseFloat(n))&&isFinite(n)?n>=i&&e>=n:n.length>=i&&e>=n.length}),this.addFunction("email",function(t,n){var i=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;return i.test(n)})}}(window.Pupil);