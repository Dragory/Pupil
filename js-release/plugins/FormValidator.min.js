(function(t){t.FormValidator=function(i){if(this.options={validationAttribute:"data-validation",highlightErrors:!0,highlightUntouched:!1},i)for(var n in i)this.options[n]=i[n];if(!this.options.highlightUntouched)for(var o=this.findChildNodes(document.body,["input","textarea"]),e=function(){this.setAttribute("data-pupil-changed","1")},r=function(t){return function(i){e.call(t,i)}},a=0;o.length>a;a++){var s=o[a];null===s.getAttribute("data-pupil-changed")&&s.setAttribute("data-pupil-changed","0"),s.addEventListener?s.addEventListener("change",e,!1):s.attachEvent("onchange",r(s))}this.Validator=new t.Validator},t.FormValidator.prototype.findChildNodes=function(t,i){var n=[],o=t.children;"object"!=typeof i&&(i=[i]);for(var e=0;o.length>e;e++){for(var r=o[e],a=!1,s=0;i.length>s;s++)("*"==i[s]||r.tagName.toLowerCase()==i[s].toLowerCase())&&(a=!0);a&&n.push(r),r.children.length>0&&(n=n.concat(this.findChildNodes(r,i)))}return n},t.FormValidator.prototype.validate=function(t,i,n){var o={},e={};if(n){e=this.options;for(var r in n)this.options[r]=n[r]}if(o=i!==void 0&&null!==i?this.validateByRules(t,i):this.validateByAttributes(t),this.options.highlightErrors){var a=this.findChildNodes(t,["input","textarea"]);this.highlightErrors(a,o)}return n&&(this.options=e),o},t.FormValidator.prototype.validateSingle=function(t,i){var n={},o={};return o[t.name]=i!==void 0&&null!==i?[t.value,i]:[t.value,t.getAttribute(this.options.validationAttribute)],n=this.Validator.validate(o),this.options.highlightErrors&&this.highlightErrors([t],n),n[t.name]},t.FormValidator.prototype.highlightErrors=function(t,i){for(var n=0;t.length>n;n++){var o=t[n].name;if(void 0!==i[o])if(i[o]===!0)this.removeElementHighlight(t[n]);else if(this.options.highlightUntouched)this.addElementHighlight(t[n]);else{var e=t[n].getAttribute("data-pupil-changed");("1"===e||null===e)&&this.addElementHighlight(t[n])}}},t.FormValidator.prototype.addElementHighlight=function(t){var i=" "+t.className+" ";-1===i.indexOf("pupil-invalid")&&(i+=" pupil-invalid"),t.className=i.trim()},t.FormValidator.prototype.removeElementHighlight=function(t){var i=" "+t.className+" ";-1!==i.indexOf("pupil-invalid")&&(i=i.replace(" pupil-invalid "," ")),t.className=i.trim()},t.FormValidator.prototype.validateByRules=function(t,i){for(var n={},o=this.findChildNodes(t,["input","textarea"]),e=0;o.length>e;e++){var r=o[e].name;void 0!==i[r]&&(n[r]=[o[e].value,i[r]])}return this.Validator.validate(n)},t.FormValidator.prototype.validateByAttributes=function(t){for(var i=this.findChildNodes(t,["input","textarea"]),n={},o=0,e=0;i.length>e;e++){var r=i[e].name,a=i[e].value,s=i[e].getAttribute(this.options.validationAttribute);r&&null!==a&&s&&(n[r]=[a,s],o++)}return o>0?this.Validator.validate(n):{}}})(window.Pupil);