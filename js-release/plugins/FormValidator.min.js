(function(t){t.FormValidator=function(i){if(this.options={validationAttribute:"data-validation",highlightErrors:!0,highlightUntouched:!1},i)for(var n in i)this.options[n]=i[n];if(!this.options.highlightUntouched)for(var e=this.findChildNodes(document.body,["input","textarea"]),o=function(){this.setAttribute("data-pupil-changed","1")},r=function(t){return function(){o.apply(t)}},a=0;e.length>a;a++){var s=e[a];null===s.getAttribute("data-pupil-changed")&&s.setAttribute("data-pupil-changed","0"),s.addEventListener?s.addEventListener("change",o,!1):s.attachEvent("change",r(s))}this.Validator=new t.Validator},t.FormValidator.prototype.findChildNodes=function(t,i){var n=[],e=t.children;"object"!=typeof i&&(i=[i]);for(var o=0;e.length>o;o++){for(var r=e[o],a=!1,s=0;i.length>s;s++)("*"==i[s]||r.tagName.toLowerCase()==i[s].toLowerCase())&&(a=!0);a&&n.push(r),r.children.length>0&&(n=n.concat(this.findChildNodes(r,i)))}return n},t.FormValidator.prototype.validate=function(t,i){var n={};if(n=i!==void 0&&null!==i?this.validateByRules(t,i):this.validateByAttributes(t),this.options.highlightErrors){var e=this.findChildNodes(t,["input","textarea"]);this.highlightErrors(e,n)}return n},t.FormValidator.prototype.validateSingle=function(t,i){var n={},e={};return e[t.name]=i!==void 0&&null!==i?[t.value,i]:[t.value,t.getAttribute(this.options.validationAttribute)],n=this.Validator.validate(e),this.options.highlightErrors&&this.highlightErrors([t],n),n[t.name]},t.FormValidator.prototype.highlightErrors=function(t,i){for(var n=0;t.length>n;n++){var e=t[n].name;if(void 0!==i[e])if(i[e]===!0)this.removeElementHighlight(t[n]);else if(this.options.highlightUntouched)this.addElementHighlight(t[n]);else{var o=t[n].getAttribute("data-pupil-changed");("1"===o||null===o)&&this.addElementHighlight(t[n])}}},t.FormValidator.prototype.addElementHighlight=function(t){var i=" "+t.className+" ";-1===i.indexOf("pupil-invalid")&&(i+=" pupil-invalid"),t.className=i.trim()},t.FormValidator.prototype.removeElementHighlight=function(t){var i=" "+t.className+" ";-1!==i.indexOf("pupil-invalid")&&(i=i.replace(" pupil-invalid "," ")),t.className=i.trim()},t.FormValidator.prototype.validateByRules=function(t,i){for(var n={},e=this.findChildNodes(t,["input","textarea"]),o=0;e.length>o;o++){var r=e[o].name;void 0!==i[r]&&(n[r]=[e[o].value,i[r]])}return this.Validator.validate(n)},t.FormValidator.prototype.validateByAttributes=function(t){for(var i=this.findChildNodes(t,["input","textarea"]),n={},e=0,o=0;i.length>o;o++){var r=i[o].name,a=i[o].value,s=i[o].getAttribute(this.options.validationAttribute);r&&null!==a&&s&&(n[r]=[a,s],e++)}return e>0?this.Validator.validate(n):{}}})(window.Pupil);